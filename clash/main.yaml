# 修改自官方示例规则 https://wiki.metacubex.one/example/#meta
# 虚空终端 (Clash Meta) Docs 地址: https://wiki.metacubex.one

# true 是启用
# false 是禁用

# 分组
pr:
  &pr {
    type: select,
    proxies:
      [
        默认代理,
        香港,
        台湾,
        日本,
        新加坡,
        美国,
        其它地区,
        全部节点,
        DIRECT,
      ],
  }
# 延迟检测 URL
p: &p
  type: http
  # 自动更新订阅时间，单位为秒
  interval: 3600
  health-check:
    enable: true
    url: https://cp.cloudflare.com
    # 节点连通性检测时间，单位为秒
    interval: 300
    # 节点超时延迟，单位为毫秒
    timeout: 1000
    # 节点自动切换差值，单位为毫秒
    tolerance: 100
# --------------------------------------------------

mode: rule
# ipv6 支持
ipv6: true
log-level: info
# 允许局域网连接
allow-lan: true
# socks5/http 端口
mixed-port: 7890
# Meta 内核特性 https://wiki.metacubex.one/config/general
# 统一延迟
# 更换延迟计算方式,去除握手等额外延迟
unified-delay: true
# TCP 并发
# 同时对所有ip进行连接，返回延迟最低的地址
tcp-concurrent: true
# 外部控制端口
external-controller: :9090

geodata-mode: true

# Geo 数据库下载地址
# 使用 FastGit 代理 (https://fgit.cf)
# 源地址 https://github.com/MetaCubeX/meta-rules-dat
# 可以更换镜像站但不要更换其他数据库，可能导致无法启动
geox-url:
  geoip: "https://ghp.ci/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://ghp.ci/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://ghp.ci/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"
#  geoip: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
#  geosite: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
#  mmdb: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"
  
# 进程匹配模式
# 路由器上请设置为 off
# always 开启，强制匹配所有进程
# strict 默认，由 Clash 判断是否开启
# off 不匹配进程，推荐在路由器上使用此模式
find-process-mode: strict

# 缓解移动设备耗电问题
# https://github.com/vernesong/OpenClash/issues/2614
keep-alive-interval: 1800

# 全局客户端指纹
global-client-fingerprint: random # 随机指纹

# 缓存
profile:
  store-selected: true
  store-fake-ip: true

# 自动同步时间以防止时间不准导致无法正常联网
ntp:
  enable: true
  # 是否同步至系统时间，需要 root/管理员权限
  write-to-system: false
  server: time.apple.com
  port: 123
  interval: 30

# 域名嗅探
sniffer:
  enable: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true

# tun 模式
tun:
  enable: false  # enable 'true'
  stack: system  # or 'gvisor'
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-detect-interface: true

hosts:
  '*.tech-assast.us.kg': 172.66.47.251
  '*.tech1-assast.us.kg': 172.66.47.251
  '*.tech2-assast.us.kg': 172.66.47.251
  'tech-assast.us.kg': 172.66.47.251
  'tech1-assast.us.kg': 172.66.47.251
  'tech2-assast.us.kg': 172.66.47.251
  'hostevaluate.com': 172.66.47.251
  'lenoas.de': 172.66.47.251
  '*.lenoas.de': 172.66.47.251
  '*.sehuatang.org': 172.66.47.251
  'u2.dmhy.org': 172.66.47.251
  'audiences.me': 172.66.47.251
  'hdfans.org': 172.66.47.251
  'rousi.zip': 172.66.47.251
  'www.haidan.video': 172.66.47.251
  'zhuque.in': 172.66.47.251
  'sunnypt.top': 172.66.47.251
  'leaves.red': 172.66.47.251
  'tracker.leaves.red': 172.66.47.251
  'tracker2.leaves.red': 172.66.47.251
  'tracker3.leaves.red': 172.66.47.251
  'pt.keepfrds.com': 172.66.47.251
  'tracker.keepfrds.com': 172.66.47.251
  'springsunday.net': 172.66.47.251
  'ubits.club': 172.66.47.251
  'lemonhd.club': 172.66.47.251
  'www.hdkyl.in': 172.66.47.251
  'tracker.hdkyl.in': 172.66.47.251
  'www.hdkylin.top': 172.66.47.251
  'agsvpt.trackers.work': 172.66.47.251
  'zmpt.cc': 172.66.47.251
  'tracker.carpt.net': 172.66.47.251
  'carpt.net': 172.66.47.251
  'ptvicomo.net': 172.66.47.251
  'tracker.ptvicomo.net': 172.66.47.251
  'pterclub.com': 172.66.47.251
  'tracker.pterclub.com': 172.66.47.251
  'blutopia.cc': 172.66.47.251
  'totheglory.im': 172.66.47.251
  'tracker.totheglory.im': 172.66.47.251
  'ourbits.club': 172.66.47.251
  'ptchdbits.co': 172.66.47.251
  'tracker.ptchdbits.co': 172.66.47.251
  'tracker.rainbowisland.co': 172.66.47.251
  'chdbits.xyz': 172.66.47.251
  'invites.fun': 172.66.47.251
  'hdtime.org': 172.66.47.251
  'qingwapt.com': 172.66.47.251
  '*.qingwapt.com': 172.66.47.251
  '*.gitbook.io': 172.66.47.251
  '*.nodehatch.com': 172.66.47.251
  '*.lap.ink': 172.66.47.251
  'tjupt.org': 172.66.47.251
  # '*.nodeseek.com': 172.66.47.251 虽然是cf的 但是好像优选也连不上
  '*.gtkpw.xyz': 172.66.47.251
  '*.cloudflare.com': 172.66.47.251
  'linux.do': 172.66.47.251
  'hhanclub.top': 172.66.47.251

# dns 设置
# 已配置 ipv6
dns:
  enable: true
  listen: :1053
  ipv6: true
  # 路由器个人建议使用 redir-host 以最佳兼容性
  # 其他设备可以使用 fake-ip
  enhanced-mode: fake-ip
  fake-ip-range: 28.0.0.1/8
  fake-ip-filter:
    - '*'
    - '+.lan'
    - '+.local'
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - 114.114.114.114
    - '[2402:4e00::]'
    - '[2400:3200::1]'
  nameserver:
    - 'tls://8.8.4.4#dns'
    - 'tls://1.0.0.1#dns'
    - 'tls://[2001:4860:4860::8844]#dns'
    - 'tls://[2606:4700:4700::1001]#dns'
#  proxy-server-nameserver:
#    - https://doh.pub/dns-query
#  nameserver-policy:
#    "geosite:cn,private":
#      - https://doh.pub/dns-query
#      - https://dns.alidns.com/dns-query
#    "geosite:!cn,!private": 
#      - "tls://dns.google"
#      - "tls://cloudflare-dns.com"

# 规则订阅
rule-providers:
  # 秋风广告拦截规则
  # https://awavenue.top
  # # 由于 Anti-AD 误杀率高，本项目已在 1.11-241024 版本更换秋风广告规则
  AWAvenue-Ads:
    type: http
    behavior: domain
    format: yaml
    # path可为空(仅限clash.meta 1.15.0以上版本)
    path: ./rule_provider/AWAvenue-Ads.yaml
    url: "https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/refs/heads/main/Filters/AWAvenue-Ads-Rule-Clash.yaml"
    interval: 600

  myproxy:
    type: http
    path: ./rule_provider/proxy.yaml
    url: "https://raw.githubusercontent.com/assast/static/refs/heads/main/clash/proxy.yaml"
    interval: 600
    behavior: classical
    format: yaml
    size-limit: 0


rules:
  - RULE-SET,AWAvenue-Ads,REJECT
  - RULE-SET,myproxy,默认代理
  # - DOMAIN-SUFFIX,infini.money,默认代理1
  # - DOMAIN-SUFFIX,gitbook.io,默认代理

  - MATCH,DIRECT